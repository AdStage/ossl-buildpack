#!/usr/bin/env bash
# bin/compile <build-dir> <cache-dir>


echo "-----> Fetching OpenSSL binaries"
mkdir /app/vendor/openssl
cd /app/vendor/openssl
curl https://moonshot-buildpack-ruby.s3.amazonaws.com/binaries/openssl.tgz -s -o - | tar xzf -
echo "-----> Got binaries"

echo "-----> Fetching ruby-2.0.0-p195 source"
mkdir /app/vendor/ruby
cd /app
curl https://moonshot-buildpack-ruby.s3.amazonaws.com/ruby-2.0.0-p195.tar.gz -s -o - | tar xzf -

echo "-----> Configuring build environment"
cd ruby-2.0.0-p195
./configure --prefix=/app/vendor/ruby --with-openssl-dir=/app/vendor/openssl

echo "-----> Building ruby-2.0.9-p195 with openssl-1.0.1e"
make install

export PATH=/app/vendor/ruby/bin:$PATH
